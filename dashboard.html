<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard de Avaliações</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"/>
</head>
<body class="bg-light">
  <div class="container py-5">
    <h2 class="mb-4">Dashboard de Avaliações</h2>

    <div class="row mb-3">
      <div class="col-md-3">
        <label>Data início:</label>
        <input type="date" id="dataInicio" class="form-control">
      </div>
      <div class="col-md-3">
        <label>Data fim:</label>
        <input type="date" id="dataFim" class="form-control">
      </div>
      <div class="col-md-3">
        <label>Tipo de Avaliação:</label>
        <select id="tipoAvaliacao" class="form-control">
          <option value="">Todos</option>
          <option value="Muito bom">Muito bom</option>
          <option value="Bom">Bom</option>
          <option value="Regular">Regular</option>
          <option value="Ruim">Ruim</option>
        </select>
      </div>
      <div class="col-md-3 d-flex align-items-end">
        <button class="btn btn-primary me-2" onclick="filtrarDados()">Filtrar</button>
        <button class="btn btn-secondary" onclick="limparFiltros()">Limpar</button>
      </div>
    </div>

    <table class="table table-bordered bg-white">
      <thead class="table-light">
        <tr>
          <th>Nome</th>
          <th>Avaliação</th>
          <th>Data</th>
        </tr>
      </thead>
      <tbody id="tabelaAvaliacoes"></tbody>
    </table>
  </div>

  <script>
      </div> <!-- fecha .container -->

    <script>
      let dadosOriginais = [];

      async function carregarAvaliacoes() {
        try {
          const resposta = await fetch('https://avaliation.onrender.com/avaliacoes');
          const dados = await resposta.json();
          dadosOriginais = dados;
          carregarTabela(dados);
        } catch (erro) {
          console.error("Erro ao carregar avaliações:", erro);
        }
      }

      function carregarTabela(lista) {
        const corpo = document.getElementById('tabelaAvaliacoes');
        corpo.innerHTML = '';
        lista.forEach(item => {
          const linha = `<tr>
              <td>${item.nome || '-'}</td>
              <td>${item.avaliacao}</td>
              <td>${new Date(item.data).toLocaleDateString()}</td>
            </tr>`;
          corpo.innerHTML += linha;
        });
      }

      function filtrarDados() {
        const inicioStr = document.getElementById('dataInicio').value;
        const fimStr = document.getElementById('dataFim').value;
        const tipo = document.getElementById('tipoAvaliacao').value;

        const inicio = inicioStr ? new Date(inicioStr + 'T00:00:00') : null;
        const fim = fimStr ? new Date(fimStr + 'T23:59:59') : null;

        const filtrados = dadosOriginais.filter(item => {
          const dataItem = new Date(item.data);
          const condData = (!inicio || dataItem >= inicio) && (!fim || dataItem <= fim);
          const condTipo = !tipo || item.avaliacao === tipo;
          return condData && condTipo;
        });

        carregarTabela(filtrados);
      }

      function limparFiltros() {
        document.getElementById('dataInicio').value = '';
        document.getElementById('dataFim').value = '';
        document.getElementById('tipoAvaliacao').value = '';
        carregarTabela(dadosOriginais);
      }

      carregarAvaliacoes();
    </script>
</body>
</html>
  </script>
</body>
</html>
